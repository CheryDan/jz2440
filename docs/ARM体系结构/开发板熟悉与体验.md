<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->

- [开发板熟悉与体验](#开发板熟悉与体验)
	- [JTAG烧写口(依赖烧写器且烧写慢缺点)](#jtag烧写口依赖烧写器且烧写慢缺点)
	- [USB转串口(观察调试信息)](#usb转串口观察调试信息)
	- [USB下载口(大文件传输注意使用前提)](#usb下载口大文件传输注意使用前提)
	- [开机试用Qt图形界面](#开机试用qt图形界面)
	- [MobaXterm和xshell](#mobaxterm和xshell)
	- [阶段总结](#阶段总结)
	- [JTAG驱动安装](#jtag驱动安装)
	- [使用JTAG烧写口](#使用jtag烧写口)
	- [LED程序烧写闹着玩儿~](#led程序烧写闹着玩儿)
	- [LCD程序烧写闹着玩儿~](#lcd程序烧写闹着玩儿)
	- [eop烧写uboot闹着玩儿~](#eop烧写uboot闹着玩儿)
	- [eop阶段总结](#eop阶段总结)
	- [eop常见报错问题](#eop常见报错问题)
	- [使用uboot烧写裸板程序](#使用uboot烧写裸板程序)
	- [系统安装闹着玩儿](#系统安装闹着玩儿)
	- [开发板和宿主机无法连通问题](#开发板和宿主机无法连通问题)
	- [END](#end)

<!-- /TOC -->
# 开发板熟悉与体验

![1535615866200.png](image/1535615866200.png)

开发板拿到手，先看看板子资源。jz2440性能其实很一般，主要是学习资料比较多，适合入手。

![1535615892380.png](image/1535615892380.png)

![1535616978956.png](image/1535616978956.png)

![1535616997484.png](image/1535616997484.png)


先了解四个接口，两个开关

* 电源接口+USB转串口SERIAL+USB下载口+JTag烧写口
* 电源开关+启动选择开关

## JTAG烧写口(依赖烧写器且烧写慢缺点)

USB烧写器：JLink+op/eop(easy open jtag)

* JLink目前极少用，盗版打击
* op/eop简单方便

![1535616170015.png](image/1535616170015.png)

* 缺点是速度非常慢，烧写大文件不建议
* 优点是烧写简单，可靠，就算板子变砖头也可以烧写。

使用前提
* 板子有JTag烧写口
* 你得有USB烧写器
* PC端或者宿主机需要有专用的烧写器驱动以及烧写程序

## USB转串口(观察调试信息)

PC机和开发板互传信息

一般串口是九针串口，但是过老，现阶段主要是USB接口

![1535616246794.png](image/1535616246794.png)

板子上串口和USB转串口集成在开发板上

使用前提
* 板子有USB转串口(本质就是串口+USB接口的转串口)
* USB转串口线
* 板子上的软件需要有USB转串口驱动
* PC端或者宿主机需要有专用的USB转串口驱动及功能软件

![1535617018496.png](image/1535617018496.png)

![1535617065264.png](image/1535617065264.png)

其实就是手机数据线看懂了莫有

## USB下载口(大文件传输注意使用前提)

* 专门用于传输大文件，前提是板子程序支持，并且支持USB驱动，支持USB下载口传输协议

![1535616642021.png](image/1535616642021.png)

使用前提
* 板子有USB下载口
* USB下载口连接线
* 板子上的软件需要有USB下载口驱动及对应的功能软件
* PC端或者宿主机需要有专用的USB下载口驱动及功能软件

![1535617014065.png](image/1535617014065.png)

![1535617191129.png](image/1535617191129.png)

接口很明显就是早期安卓使用的数据线，这年头安卓都是用TYPE-C接口了

## 开机试用Qt图形界面

![1535617274888.png](image/1535617274888.png)

![1535617286125.png](image/1535617286125.png)

使用USB转串口接口连接宿主机，安装驱动(驱动通用,WIN10可自动安装)，然后再xshell里面打开串口，就可以获取终端。

![1535617360041.png](image/1535617360041.png)

![1535617557181.png](image/1535617557181.png)

![1535617440243.png](image/1535617440243.png)

![1535617500362.png](image/1535617500362.png)

没有自动安装驱动的话，去配套光盘找找~或者，装个驱动精灵都可以的，毕竟这个驱动很通用，其他驱动就不可或缺光盘里面的驱动，或者去百度网盘找。

![1535617677414.png](image/1535617677414.png)

这几个参数固定，不可乱配置，否则会出现莫名其妙问题

## MobaXterm和xshell

![1535617612968.png](image/1535617612968.png)

* MobaXterm比较炫酷而且免费
* xshell是有企业版而且部分收费，再者去年被爆0day漏洞
* 不过，我还是习惯xshell，用的老版本企业版，有破解的。用着还可以。

## 阶段总结

![1535617750067.png](image/1535617750067.png)


## JTAG驱动安装

![1535618736389.png](image/1535618736389.png)

![1535703897752.png](image/1535703897752.png)

* 这里WIN10绝对会碰到签名问题，这个时候就需要进入禁止驱动强制签名模式

![1535703948631.png](image/1535703948631.png)

![1535703968613.png](image/1535703968613.png)

![1535704004451.png](image/1535704004451.png)

这里引入的串口是JTag包含的，一般不用。

![1535704055173.png](image/1535704055173.png)


![1535704034207.png](image/1535704034207.png)

烧写程序用oflash，不直接使用

![1535704088363.png](image/1535704088363.png)

安装额外GUI程序，这个程序会把oflash写到环境变量里面，可以直接在命令行使用。

![1535704109894.png](image/1535704109894.png)

如果不能在命令行执行oflash命令，就需要将oflash.exe添加到环境变量里。在

![1535704196116.png](image/1535704196116.png)

环境变量是以分号分割，所以必须有分号开头然后输入自己要添加的路径

## 使用JTAG烧写口

![1535704254424.png](image/1535704254424.png)


* JTAG使用三前提，软件+驱动+硬件
* JTAG接口基本属于暴力烧写，直接写到固定存储区域。就好比在开机状态下直接烧写内存一般。
* 嵌入式把内存当硬盘，所以写到内存就是写到硬盘

JTAG可烧写的文件：所有bin文件，不同类型必须符合启动引导要求

JTag烧写到哪里才能引导？

![1535704386521.png](image/1535704386521.png)

从0地址开始烧写，why?这涉及到启动引导

## LED程序烧写闹着玩儿~

视频里面扯犊子切换盘符很麻烦的，win有个特点，在资源管理器按住shift+右击就可以打开命令行

![1535704669699.png](image/1535704669699.png)

对比一下，正常右击是没有打开powershell的。但是win10的话，你安装好oflash GUI程序后建议重启，环境变量特么的并没有立即生效，有帖子说可以用管理员权限运行powershell重新读环境变量，然而，并没有鸟用，重启解决吧小伙子~

![1535704697077.png](image/1535704697077.png)

![1535705508360.png](image/1535705508360.png)

然后还要考虑程序烧写到NOR Flash还是Nand Flash。

![1535705675031.png](image/1535705675031.png)

必须选第0项，烧到2440。中间还要几个选项，照着选呗，就玩玩，都不见原理的，就是试玩~

![1535705861336.png](image/1535705861336.png)


## LCD程序烧写闹着玩儿~

![1535706110281.png](image/1535706110281.png)

这个程序需要用到串口，连接串口到PC机器，在设备管理找到对应的COM口，然后再xshell中连接COM口

![1535706054908.png](image/1535706054908.png)

这里前两项是3.5寸屏幕，后两项是4.3寸屏幕，jz2440只能测后面两项。你其实可以跑前两项，只是效果呵呵哒而已~

![1535706215628.png](image/1535706215628.png)

![1535706231136.png](image/1535706231136.png)

其实就是写显存，你自己玩玩，没啥技术含量，没涉及原理，就是闹着玩儿~


## eop烧写uboot闹着玩儿~

![1535706444200.png](image/1535706444200.png)

这个提示就是找不到CPU，视频里面也扯到，为了上次的实验，有是有要把eop接口线拔掉，说是接口线有复位接口。不知道什么鬼~

![1535706519259.png](image/1535706519259.png)

烧写后要拔线，启动随意两者都可以。烧写完后拔掉eop接口线，然后开机瞬间要按空格进入uboot界面，不然默认进入系统启动

![1535706730043.png](image/1535706730043.png)

![1535706706405.png](image/1535706706405.png)

## eop阶段总结

![1535706880337.png](image/1535706880337.png)

## eop常见报错问题

![1535706914784.png](image/1535706914784.png)

没有连接USB Jtag报错的情况下

![1535706935154.png](image/1535706935154.png)

Jtab没有链接开发板情况，开发板没有上电

![1535707023562.png](image/1535707023562.png)

![1535707050266.png](image/1535707050266.png)

找不到文件，很明显当前cmd工作目录下没有这个文件，你需要在该文件目录下shift+右击开启cmd执行oflash即可

烧写程序后要注意有些程序不支持Nor Flash启动，要注意

上电的时候还会建议Jtag排线拔掉，有复位引脚可能造成影响。

![1535707209924.png](image/1535707209924.png)

这种情况是重复打开oflash程序的原因。OpenJtag同一时间只能有一个应用程序在使用。

![1535707285202.png](image/1535707285202.png)


## 使用uboot烧写裸板程序

eop烧写巨慢，因此大文件还是用uboot来烧写

首先按上面的烧写Uboot，上电及时按空格键进入uboot菜单

![1535707719293.png](image/1535707719293.png)

连接USB下载线，宿主机可以看到新设备，安装驱动撒~

![1535707707378.png](image/1535707707378.png)

![1535707755971.png](image/1535707755971.png)

![1535707901847.png](image/1535707901847.png)

![1535707933721.png](image/1535707933721.png)

安装完成，可以使用usb下载功能。需要通过串口传输控制命令启动usb下载

![1535708000051.png](image/1535708000051.png)

使用dnw下载

![1535708031533.png](image/1535708031533.png)

![1535708046321.png](image/1535708046321.png)

![1535708066962.png](image/1535708066962.png)

![1535708086852.png](image/1535708086852.png)

可以看到瞬间下载完成。下载完成后串口终端又进入菜单。烧写完修改Nor Flash或Nand Flash启动，断开排线，开机玩起~

![1535708215370.png](image/1535708215370.png)

这两个既可以烧写uboot也可以烧写裸板程序，其实uboot就是典型的裸板程序

![1535708287625.png](image/1535708287625.png)

![1535708398301.png](image/1535708398301.png)

![1535708417157.png](image/1535708417157.png)

## 系统安装闹着玩儿

板子系统是怎么安装的呢？？？？

![1535708862401.png](image/1535708862401.png)

开发板Nand Flash比较大，Nor很小，所以系统必定放到Nand Flash


![1535708923968.png](image/1535708923968.png)

uboot烧到哪里都可以，但是系统太大肯定放Nand Flash


![1535709064459.png](image/1535709064459.png)

其实我只想吐槽一下视频里面笔画写的真特么辣鸡~大佬应该看看考研老师写的。还是有待提高啊~


整体流程

![1535709924696.png](image/1535709924696.png)


![1535710009618.png](image/1535710009618.png)

先烧写uboot到Nand Flash

![1535710071266.png](image/1535710071266.png)

再烧写内核镜像

![1535710126083.png](image/1535710126083.png)

最后烧写文件系统

![1535709602335.png](image/1535709602335.png)


![1535709583488.png](image/1535709583488.png)


关键一步，格式化参数分区，如果之前参数分区有影响的话。最好格式化一下

![1535709703337.png](image/1535709703337.png)


uboot启动读内核，内核启动挂在文件系统


开机校准屏幕

![1535709850439.png](image/1535709850439.png)

新系统开机需要屏幕校准，如果校准不方便可以通过删除配置文件，重启就可以再次校准

![1535709889430.png](image/1535709889430.png)



## 开发板和宿主机无法连通问题

![1535710397906.png](image/1535710397906.png)

三者ping问题解决

![1535710256209.png](image/1535710256209.png)

![1535710546784.png](image/1535710546784.png)

![1535710451648.png](image/1535710451648.png)

![1535710361984.png](image/1535710361984.png)

![1535710380688.png](image/1535710380688.png)

![1535710581292.png](image/1535710581292.png)

![1535710616643.png](image/1535710616643.png)

不管有多少个网卡，其实只能通过一条通路连接到开发板

![1535710692765.png](image/1535710692765.png)























## END
